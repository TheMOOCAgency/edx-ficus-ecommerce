{% extends 'edx/base.html' %}
{% load core_extras %}
{% load i18n %}
{% load staticfiles %}

{% block title %}
{% trans "Basket" %}
{% endblock title %}

{% block navbar %}
    {% include 'edx/partials/_student_navbar.html' %}
{% endblock navbar %}


{% block javascript %}
    <script src="{% static 'js/apps/basket_app.js' %}"></script>
    <script src="{% static 'js/payment_processors/cybersource.js' %}"></script>
{% endblock %}

{% block content %}
<script type="text/javascript">
    var analyticsData = {{ analytics_data|safe }};

    dataLayer = [{
    'env_work': 'prod',
    'name_site': 'https://bilan-digital.5aconseil.com/',
    'env_language': '{{ cookie_lang }}',

    'product': analyticsData.course.courseId,
    'user_login': 'YES',
    'user_email': '{{ user.email }}',

    'orderID': '5ACONS-102{{Â basket.id }}',

    'orderPaymentType': 'Paypal',

    {% if basket.contains_a_voucher %}
        {% for voucher in basket.vouchers.all %}
            'order_promotion_code': '{{ voucher.code }}',
        {% endfor %}
    {% else %}
        'order_promotion_code': 'None',
    {% endif %}

    {% for form, line_data in formset_lines_data %}
        'order_basePrice': '{{ line_data.line.price_incl_tax }}',
    {% endfor%}

    'order_price': '{{ order_total.incl_tax }}',

    }];
    dataLayer[0].order_price = parseFloat(dataLayer[0].order_price.replace(',', '.'));
    dataLayer[0].order_basePrice = parseFloat(dataLayer[0].order_basePrice.replace(',', '.'));
    dataLayer[0].order_promotion_amount = dataLayer[0].order_basePrice - dataLayer[0].order_price;
    dataLayer[0].page_name = document.title;
</script>

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','UA-33545233-1');</script>
<!-- End Google Tag Manager -->

<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
 if(dataLayer[0].env_language == "fr"){
  //$("#messages div.alertinner.wicon").html($("#messages div.alertinner.wicon").html().replace("Coupon code","Le code promo").replace("is invalid","est invalide"));
  $("div.discount>div.benefit").first().html($("div.discount>div.benefit").first().html().replace("off",""));
 }
  $("#messages").hide();
});
</script>

    <div class="basket {% if enable_client_side_checkout %}basket-client-side{% endif %}">
        <div class="container">
            {# Use a partial template so that AJAX can be used to re-render basket #}
            {% if basket.is_empty %}
                {% block emptybasket %}
                    <div class="depth depth-2 message-error-content">
                        <h3>{% trans "Your basket is empty" %}</h3>
                        {% captureas dashboard_link_start %}
                            <a href="{{ homepage_url }}">
                        {% endcaptureas %}

                        {% captureas support_link_start %}
                            <a href="{{ support_url }}">
                        {% endcaptureas %}

                        {% blocktrans with link_end="</a>" %}
                            If you have attempted to do a purchase, you have not been charged. Return to your {{ dashboard_link_start }}dashboard{{ link_end }} to try
                            again, or {{ support_link_start }}contact {{ platform_name }} Support{{ link_end }}.
                        {% endblocktrans %}
                    </div>
                {% endblock %}
            {% else %}
                {% if enable_client_side_checkout %}
                    {% include 'basket/partials/client_side_checkout_basket.html' %}
                {% else %}
                    {% include 'basket/partials/hosted_checkout_basket.html' %}
                {% endif %}
            {% endif %}
        </div>
    </div>

{% endblock content %}
